<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<title>Trade view</title>
<link rel="stylesheet" href="layout.css">
<head>
<body id="start">
<p id="appName"><h2>Hermes</h2></p>
<p>Your badges will be displayed here!</p>
<img id="moneyBags" src="./moneybags.jpeg" width="200" height="200"> 
<img id="sixseven" src="./sixseven.jpeg" width="400" height="300">
<p>Please use Rabby Wallet with the <b>Arbitrum Network</b></p>
<div id="auth">
Wallet Address: <input type="text" id="addresstext"/><p></p>
<button id="getEIP">Confirm this wallet</button>
<p id="wallet-test-outcome">Click the button below to login!</p>
<p id="invalid-address">&#128530 Maybe use a valid wallet address next time? <b>Make sure you are on Arbitrum.</b> Do you have multiple addresses? If the answer is yes, go back to your wallet and switch to the one in the input box above. &#128519</p>
<p id="sneaky-metamask">&#128545 Get that MetaMask out of here! Uninstall MetaMask (and any other wallets) from your browser extensions and use Rabby Wallet!</p>
<p id="cancel-signature">Into the &#128465 with that one! Let's try again, shall we?</p>
<p id="sign-in-error">Something went wrong. Are you signed in to your Rabby Wallet? Login and try again. &#128187</p>
</div>
<div id="code-wallet-signature">

</div>
 <div id="login">
    <p></p>
<button id="auth-login">Login with this wallet</button>
<p id="same-timestamp">&#9995 Hold it right there! You don't need to login twice!</p>
<p></p>
<p>&#128178 Active Markets: &#128178</p>
<p>You <b>must</b> use one of the assets in the green box below when you trade:</p>
<p>The L means Long and the S means Short, <br></br> but feel free to put any of these assets on the Long or Short side</p>
<div id="active-markets" style="height:100px;width:140px;overflow:auto;border:8px
solid yellowgreen; padding:2%; display:block; margin:0 auto;">
<script>
function getActiveAssets() {
fetch('https://hl-v2.pearprotocol.io/markets/active', {
    method: 'GET',
    headers: {
        "Accept": "*/*"
    }
})
.then(res => res.json())
.then(data => {
listAssets(data);
})
.catch(error => {

});

function listAssets(data){

    console.log(data.active)
for (let i = 0; i < data.active.length; i++){

    document.getElementById("active-markets").innerHTML+=` ${data.active[i].key}`;    
    
    

    // // print long assets
    // for (let j = 0; j < data.active[i].longAssets.length;j++){
    //     document.getElementById("active-markets").innerHTML+=` ${data.active[i].longAssets[j]}`;    
    // }
    // // print short assets
    // for (let j = 0; j < data.active[i].shortAssets.length;j++){
    //     document.getElementById("active-markets").innerHTML+=` ${data.active[i].shortAssets[j]}`;    
    // }

}

}

}
</script>
</div>
<div id="place-trade"><p><button id="make-trade">Trade</button> <b id="success">&#9989</b><b id="failure">&#128683 Do you have enough margin to make that trade? Are both assets on the active list? Hint: You might need to increase your USD position size beyond the minimum threshold.</b></p>
<b>Long Asset: <input type="text" id="long-asset" size="2"></b>
<!-- <b>Weight (out of 1): <input type="number" id="long-weight"></b> -->
<p></p>
<b>Short Asset: <input type="text" id="short-asset" size="2"></b>
<!-- <b>Weight (out of 1): <input type="number" id="short-weight"></b><p></p> -->
 <p></p>
<b>Position size (in USD): <input type="number" id="position-size"></b>
</div>

<div id="margin-value">
<p id="available-margin">Amount of USD available for trading assets:</p>
<script>
function showAvailableMargin(data){
var balance = '$'+data.totalValue

//document.getElementById("margin-value").innerHTML+=`<pre>$${data.totalValue}</pre>`;
document.getElementById("margin").innerHTML=balance;
    }
</script>
<pre id="margin"></pre>
</div>

<div id="open-positions">
<p id="current-position">Positions:</p>

<script>
function showPositions(data){ // now make a loop that shows all information needed for positions
var i = 0;
console.log(data);

for(i=0; i<data.length; i++){
    // document.getElementById("open-positions").innerHTML+=`<pre id="position0">${data[i].positionId}</pre> `;

    document.getElementById("open-positions").innerHTML+=`<pre id="position1">Profit and Loss: $${data[i].unrealizedPnl.toFixed(2)}</pre>`;

    document.getElementById("open-positions").innerHTML+=` <pre id="position2">Entry Value: $${data[i].entryPositionValue.toFixed(2)}</pre>`;

    document.getElementById("open-positions").innerHTML+=` <pre id="position3">Current Value: $${data[i].positionValue.toFixed(2)}</pre>`;

    document.getElementById("open-positions").innerHTML+=` <pre id="position4">Long: </pre>`;
    // get all long assets
    for (var j = 0; j<data[i].longAssets.length; j++){

    document.getElementById("open-positions").innerHTML+=` <pre id="position5">${data[i].longAssets[j].coin}</pre>`;    
    }
    // if (data[i].longAssets.length==0){
    //     document.getElementById("open-positions").innerHTML+=` <b id="position6">No long assets </b>`;
    // }    

    document.getElementById("open-positions").innerHTML+=` <pre id="position6">Short: </pre>`;
    // get all short assets
    for (var j = 0; j<data[i].shortAssets.length; j++){

    document.getElementById("open-positions").innerHTML+=` <pre id="position7">${data[i].shortAssets[j].coin}</pre>`;    
    }
    // if(data[i].shortAssets.length == 0){
    //     document.getElementById("open-positions").innerHTML+=` <b id="position9">No short assets </b>`;
    // }

    document.getElementById("open-positions").innerHTML+= `<button id="position8" onClick="closeEntirePos('${data[i].positionId}')"><pre >Close entire position</pre></button>`;

    document.getElementById("open-positions").innerHTML+="<p><p>"// line break between positions
}

}
</script> 
<script>
function showPositionRecent(data){ // now make a loop that shows all information needed for positions
var i = 0;
console.log(data);


    // document.getElementById("open-positions").innerHTML+=`<pre id="position0">${data.positionId}</pre> `;

    document.getElementById("open-positions").innerHTML+=`<pre id="position1">Profit and Loss: $${data.unrealizedPnl.toFixed(2)}</pre>`;

    document.getElementById("open-positions").innerHTML+=` <pre id="position2">Entry Value: $${data.entryPositionValue.toFixed(2)}</pre>`;

    document.getElementById("open-positions").innerHTML+=` <pre id="position3">Current Value: $${data.positionValue.toFixed(2)}</pre>`;

    document.getElementById("open-positions").innerHTML+=` <pre id="position4">Long: </pre>`;
    // get all long assets
    for (var j = 0; j<data.longAssets.length; j++){

    document.getElementById("open-positions").innerHTML+=` <pre id="position5">${data.longAssets[j].coin}</pre>`;    
    }
    // if (data[i].longAssets.length==0){
    //     document.getElementById("open-positions").innerHTML+=` <b id="position6">No long assets </b>`;
    // }    

    document.getElementById("open-positions").innerHTML+=` <pre id="position6">Short: </pre>`;
    // get all short assets
    for (var j = 0; j<data.shortAssets.length; j++){

    document.getElementById("open-positions").innerHTML+=` <pre id="position7">${data.shortAssets[j].coin}</pre>`;    
    }
    // if(data[i].shortAssets.length == 0){
    //     document.getElementById("open-positions").innerHTML+=` <b id="position9">No short assets </b>`;
    // }

    document.getElementById("open-positions").innerHTML+= `<button id="position8" onClick="closeEntirePos('${data.positionId}')"><pre >Close entire position</pre></button>`;

    document.getElementById("open-positions").innerHTML+="<p><p>"// line break between positions
}


</script> 
</div>
<script type="module" src="script.js"></script>
<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
</body>
</head>
</html>